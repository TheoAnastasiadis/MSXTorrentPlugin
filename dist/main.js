(()=>{"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class t{constructor(t,r){e(this,"streamTorrent",(async()=>{let e=await navigator.serviceWorker.register("sw.js",{scope:"./"});for(;!e.active;);await this.client.loadWorker(e.active),console.log("Service Worker ready"),this.client.on("error",(function(e){console.error("ERROR: "+e.message)})),this.client.add(this.torrentId,(async e=>{e.on("warning",(e=>{console.warn(e)})),e.on("error",(e=>{console.error(e)}));const t=document.getElementById("video");e.files[this.fileIdx].streamTo(t)}))})),this.torrentId=t,this.fileIdx=r,this.client=new window.WebTorrent}}e(t,"IS_CLIENT_COMPATIBLE",(()=>WebTorrent.WEBRTC_SUPPORT&&!!navigator.serviceWorker));const r=t,i="torrent:";class o{constructor(){this.player=document.getElementById("video"),this.init=()=>{},this.ready=()=>{TVXVideoPlugin.requestData("video:info",(e=>{const t=e?.video?.info,o=TVXPropertyTools.getFullStr(t,i+"id",null)||new TVXUrlParams(window.location.href).getFullStr("torrent",null),n=TVXPropertyTools.getNum(t,i+"fileIdx",null)||new TVXUrlParams(window.location.href).getNum("fileIdx",0);if(!o)return void TVXVideoPlugin.error("Error: No torrent id (infoHash, magnerURI or .torrent file) specified.");const s=TVXPropertyTools.getBool(t,i+"server:precedence",!1);r.IS_CLIENT_COMPATIBLE()&&!s?function(e,t){console.log(`Local player: (${e}, ${t})`),new r(e,t).streamTorrent()}(o,n):s||TVXVideoPlugin.error("Your system does not support WebTorrent. Will try to use TorrServer as fallback...")})),TVXVideoPlugin.startPlayback()},this.play=()=>{this.player.play()},this.pause=()=>{this.player.pause()},this.stop=()=>{this.player.pause(),TVXVideoPlugin.stopPlayback()},this.getDuration=()=>this.player.duration,this.getPosition=()=>this.player.currentTime,this.setPosition=e=>{this.player.currentTime=e},this.setMuted=()=>{this.player.muted=!0},this.isMuted=()=>this.player.muted,this.getSpeed=()=>this.player.playbackRate,this.setSpeed=e=>{this.player.playbackRate=e},this.getUpdateData=()=>({position:this.getPosition(),duration:this.getDuration(),speed:this.getSpeed()})}}TVXPluginTools.onReady((function(){TVXVideoPlugin.setupPlayer(new o),TVXVideoPlugin.init()}))})();